try:
    import time
    from sys import __stdout__, stdout
    from threading import Thread
    from subprocess import *
    import os
    import sys
    import subprocess
    import threading
    import readline
    from termcolor import colored
except ImportError:
    print("\ncheck for prerequisities ")


def cms_scan(target):
    os.system('clear')
    p = './cms/'
    try:
        os.mkdir(p)

    except FileExistsError as exc:
        print(exc)
    print(colored("\n--------------------------------------------",
                  'red', attrs=['bold']))
    print(
        colored("[+] Starting cms scanner", 'red', attrs=['bold']))
    print(colored("--------------------------------------------",
                  'red', attrs=['bold']))
    print(colored("\n[*]\tRunning cms scanner", 'red', attrs=['bold']))
    cmd = [
        'python3 ~/Tools/CMSeeK/cmseek.py -u' + target + ' --batch -r '
    ]
    try:
        for c in cmd:
            proc = subprocess.run(
                c, shell=True, stderr=STDOUT, stdout=sys.stdout)
        if(proc.returncode != 0):
            print(colored('Step 1 Failed! Check/Update prerequisitie packages. \nError: ',
                          'blue', attrs=['bold']) + proc.stderr.rstrip())
            sys.exit(1)
        else:
            print(colored("[x] Executed", 'blue', attrs=['bold']))
    except:
        print("Something went wrong! Check prerequisities.\n")

    cmd1 = 'mv ~/Tools/CMSeeK/Result/' + target + '/ ./output/cmsCheck'
    try:
        proc = subprocess.run(
            cmd1, shell=True, stderr=STDOUT, stdout=sys.stdout)
        if(proc.returncode != 0):
            return "Failed to read result"

        with open('./output/cmsCheck/'+target+'/cms.json') as result:
            return result.read()
    except:
        return "An error occured"


# result = cms_scan('jiit.ac.in')
# print(result)
