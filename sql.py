try:
    import time
    from sys import __stdout__, stdout
    from threading import Thread
    from subprocess import *
    import os
    import sys
    import subprocess
    import threading
    import readline
    from termcolor import colored
except ImportError:
    print("\ncheck for prerequisities ")


def getDirName(string):
    left, right = string.split('://')
    right = right.split('/')
    return right[0]


def checkSqli(target):
    os.system('clear')
    p = './output/server_info/'
    try:
        os.mkdir(p)

    except FileExistsError as exc:
        print(exc)
    sqlmap = '~/Tools/sqlmap/sqlmap.py'
    cmd = [
        'python3 ' + sqlmap + ' -u ' + target + ' --batch --output-dir=output/sqli'
    ]
    # print(cmd[0])
    try:
        proc = subprocess.run(cmd[0], shell=True, stderr=STDOUT, stdout=PIPE)
        if(proc.returncode != 0):
            print(colored('Step 1 Failed! Check/Update prerequisitie packages. \nError: ',
                          'blue', attrs=['bold']) + proc.stderr.rstrip())
            sys.exit(1)
        else:
            print(colored("[x] Executed", 'blue', attrs=['bold']))
    except:
        print("Something went wrong! Check prerequisities.\n")
    dirname = getDirName(target)
    try:
        if(os.path.getsize('output/sqli/'+dirname+'/log') > 0):
            with open('output/sqli/'+dirname+'/log') as test:
                return test.read()
        else:
            return "Not vulnerable to sql injection"
    except:
        return "Some error occured, try again"
