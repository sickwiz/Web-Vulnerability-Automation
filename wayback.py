import requests
import sys
from sys import __stdout__, stdout
import json
import os
import subprocess


def waybackMachine(host):
    os.system('clear')
    p = './output/wayback'
    try:
        os.mkdir(p)
    except FileExistsError as exc:
        print(exc)

    try:
        subprocess.run('rm -rf output/wayback/results.json',
                       shell=True, stdout=PIPE)
    except:
        pass

    url = 'http://web.archive.org/cdx/search/cdx?url=*.%s/*&output=json&fl=original&collapse=urlkey' % host

    try:
        r = requests.get(url)
        result = r.json()
        # print(r)
        try:
            with open('output/wayback/results.json', 'w+') as f:
                f.write(json.dumps(result[1:]))
                return True
        except:
            return False
    except:
        return False
